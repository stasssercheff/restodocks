# Исправление входа и регистрации

## Причина проблемы
1. **RLS в Supabase** — политики блокировали анонимный доступ к `employees` и `establishments`. Приложение использует вход по email/паролю (не Supabase Auth), поэтому `auth.uid()` = null и все запросы возвращали пустые результаты.
2. **Возможная порча env-переменных** — лишние символы (переносы строк) в SUPABASE_URL/SUPABASE_ANON_KEY в Vercel.

## Что сделано в коде
- `vercel-build.sh` — очистка env от лишних символов при сборке config.json
- `main.dart` — trim URL и ключа при загрузке
- `supabase_migration_anon_login.sql` — новые RLS-политики для анонимного доступа

## Что нужно сделать вручную

### 1. Выполнить миграцию в Supabase
1. Откройте Supabase Dashboard → проект Restodocks
2. SQL Editor → New query
3. Скопируйте содержимое файла `supabase_migration_anon_login.sql`
4. Нажмите Run

### 2. Проверить переменные в Vercel
1. Vercel → проект restodocks → Settings → Environment Variables
2. Убедитесь, что **SUPABASE_URL** и **SUPABASE_ANON_KEY** указаны без переносов строк и пробелов
3. Значения можно взять из Supabase: Project Settings → API (Project URL и anon public key)

### 3. Задеплоить приложение
После выполнения миграции сделайте новый деплой, чтобы применить изменения в коде.
