# Настройка Supabase для Restodocks — пошагово

Подробная инструкция: куда заходить, куда копировать, что нажимать.

---

## Что такое «SQL Editor» и куда копировать

**SQL Editor** в Supabase — это экран, где вы вводите команды для базы данных (SQL).  
Там есть **большое белое поле** (окно запроса).  
**Скопировать** — значит: взять текст из файла на вашем компьютере и **вставить** его в это белое поле.  
**Выполнить (Run)** — нажать кнопку **Run** (или Ctrl+Enter). После этого Supabase выполнит команды и покажет результат внизу.

**Где именно:**  
Supabase → ваш проект → в левом меню пункт **SQL Editor** → откроется страница с полем для ввода. Туда и вставляйте скрипты.

---

## Шаг 0. Откройте Supabase и SQL Editor

1. Зайдите на [supabase.com](https://supabase.com) и войдите в аккаунт.
2. Выберите проект Restodocks.
3. В **левом меню** нажмите **SQL Editor**.
4. Убедитесь, что видите страницу с заголовком вроде «SQL Editor» и **большим пустым полем** для текста. Это и есть то место, **куда нужно копировать** все скрипты из инструкции.

---

## Шаг 1. Базовые таблицы (уже сделали — можно пропустить)

Вы уже запускали `supabase_tables_safe.sql` и видели «такая таблица уже есть».  
Значит, этот шаг **выполнен**. Переходите к шагу 2.

---

## Шаг 2. Чеклисты

### 2.1. Откройте файл на компьютере

В проекте Restodocks найдите файл:

```
restodocks_flutter/supabase_migration_checklists.sql
```

Откройте его в редакторе (VS Code, Cursor, Блокнот — неважно).

### 2.2. Скопируйте весь текст файла

- Выделите **весь** текст в файле (Ctrl+A / Cmd+A).
- Скопируйте (Ctrl+C / Cmd+C).

### 2.3. Вставьте в Supabase и запустите

- Вернитесь в браузер: **Supabase → SQL Editor**.
- В **большом белом поле** удалите старый текст (если есть), затем **вставьте** скопированный текст (Ctrl+V / Cmd+V).
- Нажмите кнопку **Run** (справа вверху или внизу).

### 2.4. Что вы можете увидеть

- Сообщение вроде **«Success»** — всё хорошо, переходите к шагу 3.
- Сообщение **«already exists»** — таблицы чеклистов уже есть, тоже всё хорошо, переходите к шагу 3.

---

## Шаг 3. Полуфабрикаты в ТТК (ПФ)

### 3.1. Откройте файл

```
restodocks_flutter/supabase_migration_ttk_source_tech_card.sql
```

### 3.2. Скопируйте весь текст

- Выделите всё (Ctrl+A), скопируйте (Ctrl+C).

### 3.3. Вставьте в SQL Editor и запустите

- В Supabase **SQL Editor** очистите поле (или откройте **New query**, если есть такая кнопка).
- Вставьте скопированный текст (Ctrl+V).
- Нажмите **Run**.

### 3.4. Результат

- **Success** или **already exists** — нормально. Переходите к шагу 4.

---

## Шаг 4. Продукты (1000 штук из каталога)

Сейчас мы добавим в базу список продуктов, чтобы они появились в приложении.

### 4.1. Найти файл `seed_products.sql`

В проекте должен быть файл:

```
restodocks_flutter/seed_products.sql
```

Если его нет — его нужно сгенерировать (см. конец инструкции).  
Если есть — откройте его.

---

### 4.2. Что значит «выполнить DELETE FROM products»

**DELETE FROM products** — это одна отдельная команда SQL.  
Она **удаляет все строки** из таблицы `products` (очищает список продуктов).  
Её нужно **выполнить только в одном случае**:  
если вы **уже раньше** запускали вставку продуктов (`seed_products.sql`) и теперь хотите **запустить её снова**.  
Без очистки при повторной вставке база выдаст ошибку про дубликаты.

**Как выполнить DELETE FROM products:**

1. Откройте **Supabase → SQL Editor**.
2. Убедитесь, что в **большом белом поле** нет ничего лишнего (или нажмите **New query**).
3. Наберите **ровно** эту строку:
   ```text
   DELETE FROM products;
   ```
4. Нажмите **Run**.
5. Должно появиться что‑то вроде «Success» (и, возможно, сколько строк удалено). После этого переходите к п. 4.3.

**Если вы впервые** добавляете продукты и **никогда** не запускали `seed_products.sql` — шаг с **DELETE FROM products** можно **пропустить** и сразу делать 4.3.

---

### 4.3. Вставить продукты (seed_products.sql)

1. Откройте файл **`restodocks_flutter/seed_products.sql`** на компьютере.
2. Выделите **весь** текст (Ctrl+A), скопируйте (Ctrl+C).
3. В **Supabase → SQL Editor** очистите поле (удалите `DELETE FROM products;`, если вы его только что вводили).
4. **Вставьте** в это же поле весь скопированный текст из `seed_products.sql` (Ctrl+V).
5. Нажмите **Run**.
6. Подождите несколько секунд — вставка большая. Внизу должно появиться **Success** (без красных ошибок).

---

### 4.4. Проверка

В SQL Editor очистите поле и введите **только** эту строку:

```text
SELECT COUNT(*) FROM products;
```

Нажмите **Run**.  
В результатах должна быть цифра **1000** (или близко к тому). Значит, продукты в базе есть.

---

## Кратко: куда копировать и что нажимать

| Шаг | Что открыть на ПК | Куда вставить | Что нажать |
|-----|-------------------|---------------|------------|
| 2   | `supabase_migration_checklists.sql` | Большое белое поле в **Supabase → SQL Editor** | **Run** |
| 3   | `supabase_migration_ttk_source_tech_card.sql` | То же поле (предварительно очистить или New query) | **Run** |
| 4   | При необходимости: ввести `DELETE FROM products;` | То же поле | **Run** |
| 4   | `seed_products.sql` | То же поле (очистить, вставить скрипт) | **Run** |

**«Куда скопировать»** = всегда в **большое белое поле** на странице **SQL Editor** в Supabase.  
**«Выполнить DELETE FROM products»** = ввести в это поле только `DELETE FROM products;`, нажать **Run**, потом вставить уже `seed_products.sql` и снова **Run**.

---

## Если нет файла `seed_products.sql`

Его можно сгенерировать из каталога продуктов. В терминале (в папке проекта):

```bash
cd restodocks_flutter
python3 scripts/seed_products_from_catalog.py
```

После этого в `restodocks_flutter` появится файл **`seed_products.sql`**. Дальше действуйте по шагу 4.

---

## После настройки

Обновите страницу приложения (или перезапустите его).  
В разделе продуктов, ТТК и инвентаризации должен появиться список.  
Чеклисты и полуфабрикаты в ТТК тоже будут работать, как описано в приложении.
